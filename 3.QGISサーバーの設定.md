[0. GIS-WEBアプリケーションの選定](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/0.%20GIS-WEB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E9%81%B8%E5%AE%9A.md)  
[1.WebARENAの設定](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/1.%E4%BB%AE%E6%83%B3%E7%92%B0%E5%A2%83%E3%81%AE%E8%A8%AD%E5%AE%9A.md)  
[2.WEB環境の構築](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/2.WEB%E7%92%B0%E5%A2%83%E3%81%AE%E6%A7%8B%E7%AF%89.md)  

### 3.QGISサーバーの設定  
#### 3-1. QGISサーバーのインストール  
インストールの本格的な詳細は  
https://docs.qgis.org/3.22/pdf/ja/QGIS-3.22-ServerUserGuide-ja.pdf  

##### 3-1-1.QGISサーバーのインストール
詳細は下記の「QGIS Serverをインストールする場合には、次のコマンドを入力します:」を参照  
　htps://qgis.org/ja/site/forusers/alldownloads.html  
 
sudo apt -y upgrade  
sudo apt -y update  
sudo apt -y install qgis-server --no-install-recommends --no-install-suggests  
sudo apt -y autoremove  

↓2023/02/26現在　見つからないと怒られます  
sudo apt -y install python-qgis  

##### 3-1-2.QGIS-Plugin-Managerのインストール  
詳細は https://pypi.org/project/qgis-plugin-manager/  

sudo su
sudo apt -y install python3-pip
sudo pip3 install qgis-plugin-manager  
sudo python3 -m pip install qgis-plugin-manager
#初期化
qgis-plugin-manager init

（2023-02-26ここまでチャック終了）


##### 3-1-3.QGISのログと認証データベースを格納するディレクトリを作成  
mkdir -p /var/log/qgis/  
chown www-data:www-data /var/log/qgis  
mkdir -p /home/qgis/qgisserverdb  
chown www-data:www-data /home/qgis/qgisserverdb  
systemctl restart apache2  

##### 3-1-4.QGISサーバーのテスト 
systemctl restart apache2
/usr/lib/cgi-bin/qgis_mapserv.fcgi  
　を実行！  
　正しくインストールされていると下記のようになるらしい！
![image](https://user-images.githubusercontent.com/86514652/221395008-e19b8868-cdbd-4fd2-aecf-4c48b07ec17f.png)  
　詳細は下記を参照  
https://docs.qgis.org/3.22/ja/docs/server_manual/getting_started.html#installation-on-debian-based-systems   

#### 3-2. Apache2の設定（QGIS Server Plugin含む）  
・000-default.conf　，000-default-le-ssl.conf　の設定  
　　Include conf-available/lizmap-fcgi.conf  
　　Include conf-available/serve-cgi-bin.conf  
　を追加  
 ![image012](https://user-images.githubusercontent.com/86514652/174402261-b6a5f179-bbc3-4790-b402-1b85435ff2d1.png)

#### 3-3. lizmap-fcgi.conf　の作成  
nano /etc/apache2/conf-available/lizmap-fcgi.conf   
（編集内容）  
FcgidInitialEnv SCRIPT_FILENAME /usr/lib/cgi-bin/qgis_mapserv.fcgi  

#バージョンアップごとに設定しないでもいい方法を今後検討！  
FcgidInitialEnv QGIS_PLUGINPATH /var/www/lizmap-web-client-3.5.3/lizmap/plugins  
FcgidInitialEnv QGIS_PLUGINPATH /usr/lib/qgis/plugins  

#QGISサーバー側のすべての機能を有効にする  
FcgidInitialEnv QGIS_SERVER_LIZMAP_REVEAL_SETTINGS=True

#QGISのマルチスレッド化  
#並列レンダリングがアクティブ化されたときに使用するスレッドの数。  
#値が指定されている場合は、プロセッサ コアの数を使用します。‎-1  
FcgidInitialEnv QGIS_SERVER_MAX_THREADS 10  

#WMS GetMap 要求の並列レンダリングをアクティブにします。  
#デフォルトでは() は無効になっています。使用可能な値は次のとおりです。‎false  
#0‎または (大文字と小文字を区別しない)‎false  
#1‎または (大文字と小文字を区別しない)‎true  
FcgidInitialEnv QGIS_SERVER_PARALLEL_RENDERING 1  

#FcgidInitialEnv QGIS_DEBUG 1  
#FcgidInitialEnv QGIS_AUTH_DB_DIR_PATH /opt/lizmap/data/qgis  
#FcgidInitialEnv QGIS_AUTH_PASSWORD_FILE /opt/lizmap/data/qgis/qgis-auth.db  

#FcgidInitialEnv PGPASSFILE /opt/lizmap/data/qgis/.pgpass  
#FcgidInitialEnv PGSERVICEFILE /opt/lizmap/data/qgis/.pg_service.conf  
#FcgidInitialEnv QGIS_SERVER_LOG_FILE /opt/lizmap/data/qgis/qgisserver.log  
#FcgidInitialEnv QGIS_SERVER_LOG_LEVEL 0   
  
\<IfModule mod_fcgid.c>  
    RewriteEngine on  
    RewriteCond %{HTTP:Authorization} .  
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]  
\</IfModule>   
  
[3.QGISサーバーの設定](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/3.QGIS%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E8%A8%AD%E5%AE%9A.md)  
[4.PostgreSQLデータベースの構築](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/4.PostgreSQL%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E6%A7%8B%E7%AF%89.md)  
[5.Lizmap Web Clientの設定](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/tree/main/5.Lizmap%20Web%20Client%E3%81%AE%E8%A8%AD%E5%AE%9A)  
　　[5-1. Lizmap Web Clientのソースコードのインストールと設定](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/5.Lizmap%20Web%20Client%E3%81%AE%E8%A8%AD%E5%AE%9A/5-1%20.Lizmap%20Web%20Client%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB.md)  
　　[5-1-1.インストールエラー　Error in the main configuration.](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/5.Lizmap%20Web%20Client%E3%81%AE%E8%A8%AD%E5%AE%9A/5-1-1%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%82%A8%E3%83%A9%E3%83%BC%E3%80%80Error%20in%20the%20main%20configuration.md)  
　　[5-2. Lizmap Web Clientのadminパスワード変更](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/5.Lizmap%20Web%20Client%E3%81%AE%E8%A8%AD%E5%AE%9A/5-2.Lizmap%20Web%20Client%E3%81%AE%E5%88%9D%E6%9C%9F%E8%A8%AD%E5%AE%9A.md)  
　　[5-3. Lizmap Web Clientの高速化（PHPのマルチスレッド化）](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/5.Lizmap%20Web%20Client%E3%81%AE%E8%A8%AD%E5%AE%9A/5-3.Lizmap%20Web%20Client%E3%81%AE%E9%AB%98%E9%80%9F%E5%8C%96%EF%BC%88PHP%E3%81%AE%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E5%8C%96%EF%BC%89.md)  
　　[5-4. Lizmap Web Clientの高速化（QGIS Serverのマルチスレッド化）](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/5.Lizmap%20Web%20Client%E3%81%AE%E8%A8%AD%E5%AE%9A/5-4.Lizmap%20Web%20Client%E3%81%AE%E9%AB%98%E9%80%9F%E5%8C%96%EF%BC%88QGIS%20Server%E3%81%AE%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E5%8C%96%EF%BC%89.md)  
　　[5-6. qgis-plugin-managerの設定](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/5.Lizmap%20Web%20Client%E3%81%AE%E8%A8%AD%E5%AE%9A/5-5.Lizmap%20Web%20Client%E3%81%AE%E9%AB%98%E9%80%9F%E5%8C%96%EF%BC%88py-qgis-server%E3%81%AE%E5%B0%8E%E5%85%A5%EF%BC%89.md)  
